{% extends 'base.html' %}

{% block title %}
    data entry
{% endblock %}

{% block content %}
<div>
    {%- for breadcrumb in breadcrumbs -%}
        <a href="{{ breadcrumb.url }}">{{ breadcrumb.text }}</a>
        {{ '/' if not loop.last }}
    {%- endfor -%}
</div>
<h1>Data Entry</h1>

<form method="post">
    <div class="form-row">
      <div class="form-group col-md-6"> 
        <label for="study_id">Study ID</label>
        <input type="text" name="study_id"
              class="form-control"
              value="{{ request.form['study_id'] }}" 
              required></input>

      </div>
      <div class="form-group col-md-4">
        <label for="type">Document-Type :</label>
        <select name="type" class="form-control">

          {% for type in source_type %}
          <option value="{{ type }}" SELECTED>{{ type }}</option>

          {% endfor %}
        </select> 
      </div>

      <div class="form-group col-md-2">
        <label for="scr_no">Scr No</label>
        <input type="text" name="scr_no"
              value="{{ request.form['scr_no'] }}"></input>
      </div>
    </div>
    <br>  

    <table data-ticket-table class="table">
      <thead class="thead-light">
        <tr>
          <th scope="col">Visit</th>
          <th scope="col">Page</th>
          <th scope="col">Procedure</th>
          <th scope="col">Description</th>
          <th scope="col">Responsible</th>

        </tr>
      </thead>
      <tbody>
        <!-- ein attribut, den es nur fÃ¼r uns gibt 'data-ticket-row' -->
        <tr data-ticket-row>
          <td>
            <div class="form-group">
              <input type="text" name="row[][visit]"
                      placeholder="which visit?" class="form-control"
                      value="{{ request.form['visit'] }}"></input>
            </div>
          </td>
          
          <td>
            <div class="form-group">
              <input type="text" name="row[][page]"
                      placeholder="which page?" class="form-control"
                      value="{{ request.form['page'] }}"></input>
            </div>
          </td>
          <td>
            <div class="form-group">
              <input type="text" name="row[][title]"
                     placeholder="VS / ECG / ... ?" class="form-control"
                     value="{{ request.form['title'] }}"></input>
            </div>
          </td>
          <td>
            <div class="form-group">
              <textarea name="row[][description]" placeholder="Please describe your finding"
                        class="form-control" required>{{ request.form['description'] }}</textarea>
             </div>

          </td>
          <td>    
            <div class="form-group">
            <select name="row[][name]" width="300px">
              <option SELECTED>no data yet</option>
              <option disabled="disabled">----</option>

              {% for user in Users %}
              <option value="{{ user.abbrev }}">{{ user.abbrev }}</option>
          
              {% endfor %}
            </select> 
        </div>
      </td>
      </tr>
    </tbody>

    </table>
  <div class="form-group">
    <button type="submit" class="btn btn-primary" style="margin-left: 50%">Submit</button>
    <button type="button" class="btn btn-primary" id="add_row" style="float: right;">add row</button>

    <script>
      document.getElementById("add_row").onclick = function(){
        let ticket_row = document.querySelector("tr[data-ticket-row]");
        let ticket_table = document.querySelector("table[data-ticket-table] tbody");

        // copy the row; find the values with 'querySelectorAll'; transform it into an array, which you map
        let ticket_row_clone = ticket_row.cloneNode(true);
        let inputs = ticket_row_clone.querySelectorAll("input, textarea");
        inputs = Array.from(inputs);
        inputs.map(input => input.value = "");
  
        ticket_table.appendChild(ticket_row_clone);
        console.log("add new row");

      }
      
    </script>
  </div>
</form>

{% endblock %}
